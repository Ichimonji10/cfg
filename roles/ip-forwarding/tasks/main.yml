---
- block:

  - name: Enable IP forwarding
    sysctl:
      name: net.ipv4.ip_forward
      state: present
      sysctl_file: /etc/sysctl.d/ip-forwarding.conf
      value: '1'
    when: ip_forwarding

  - name: Drop sysctl configuration file for IP forwarding
    file:
      path: /etc/sysctl.d/ip-forwarding.conf
      state: absent
    when: not ip_forwarding
    register: result

  - name: Disable IP forwarding
    sysctl:
      name: net.ipv4.ip_forward
      value: '0'
      sysctl_set: true
    when: result is changed

  become: true
