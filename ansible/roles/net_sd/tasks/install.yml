---
- block:

  - name: Install network management tools
    pacman:
      name:
        - iwd
        - systemd-networkd
        - systemd-resolved
      state: present

  - name: Install configuration file(s) for iwd
    copy:
      src: main.conf
      dest: /etc/iwd/
      mode: 0644

  - name: Install configuration file(s) for systemd-networkd
    copy:
      src: '{{ item }}'
      dest: /etc/systemd/network/
      mode: 0644
    loop:
      - 50-wired.network
      - 50-wireless.network

  - name: Install configuration file(s) for systemd-resolved
    copy:
      src: resolved.conf
      dest: /etc/systemd/
      mode: 0644

  - name: Start and enable networking services
    systemd:
      name: '{{ item }}'
      state: started
      enabled: true
    loop:
        - iwd.service
        - systemd-networkd.service
        - systemd-resolved.service

  become: true
